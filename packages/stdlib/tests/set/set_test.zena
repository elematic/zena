// Set stdlib tests using zena:test
import {suite, test, TestContext} from 'zena:test';
import {equal, isTrue, isFalse} from 'zena:assert';
import {Set} from 'zena:set';

export let tests = suite('Set', (): void => {
  test('starts empty', (ctx: TestContext): void => {
    let s = new Set<i32>();
    equal(s.size, 0);
  });

  test('add increases size', (ctx: TestContext): void => {
    let s = new Set<i32>();
    s.add(1);
    equal(s.size, 1);
    s.add(2);
    equal(s.size, 2);
  });

  test('add returns true for new values', (ctx: TestContext): void => {
    let s = new Set<i32>();
    isTrue(s.add(1));
    isTrue(s.add(2));
  });

  test('add returns false for existing values', (ctx: TestContext): void => {
    let s = new Set<i32>();
    s.add(1);
    isFalse(s.add(1));
  });

  test('has returns true for existing values', (ctx: TestContext): void => {
    let s = new Set<i32>();
    s.add(42);
    isTrue(s.has(42));
  });

  test('has returns false for non-existing values', (ctx: TestContext): void => {
    let s = new Set<i32>();
    s.add(42);
    isFalse(s.has(99));
  });

  test('delete removes values', (ctx: TestContext): void => {
    let s = new Set<i32>();
    s.add(1);
    s.add(2);
    isTrue(s.delete(1));
    equal(s.size, 1);
    isFalse(s.has(1));
    isTrue(s.has(2));
  });

  test('delete returns false for non-existing values', (ctx: TestContext): void => {
    let s = new Set<i32>();
    isFalse(s.delete(99));
  });

  test('clear removes all values', (ctx: TestContext): void => {
    let s = new Set<i32>();
    s.add(1);
    s.add(2);
    s.add(3);
    s.clear();
    equal(s.size, 0);
    isFalse(s.has(1));
    isFalse(s.has(2));
    isFalse(s.has(3));
  });

  test('handles string values', (ctx: TestContext): void => {
    let s = new Set<string>();
    s.add('hello');
    s.add('world');
    isTrue(s.has('hello'));
    isTrue(s.has('world'));
    isFalse(s.has('foo'));
  });

  test('handles many values (triggers resize)', (ctx: TestContext): void => {
    let s = new Set<i32>();
    var i = 0;
    while (i < 100) {
      s.add(i);
      i = i + 1;
    }
    equal(s.size, 100);
    
    // Verify all values are present
    i = 0;
    while (i < 100) {
      isTrue(s.has(i));
      i = i + 1;
    }
  });

  test('does not add duplicates after resize', (ctx: TestContext): void => {
    let s = new Set<i32>();
    var i = 0;
    while (i < 50) {
      s.add(i);
      i = i + 1;
    }
    
    // Try adding duplicates
    i = 0;
    while (i < 50) {
      isFalse(s.add(i));
      i = i + 1;
    }
    
    equal(s.size, 50);
  });
});
