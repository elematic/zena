// @mode: run
// @stdout: one: 1\ntwo: 2\nsize: 2\nhas one: true\nhas three: false\nsize after delete: 1\nhas one after delete: false\np1: Point 1\np2: Point 2\np3 (equal to p1): Point 1

import {Map} from 'zena:map';
import {Box} from 'zena:box';

class Point {
  x: i32;
  y: i32;

  #new(x: i32, y: i32) {
    this.x = x;
    this.y = y;
  }

  hashCode(): i32 {
    return this.x * 31 + this.y;
  }

  operator ==(other: Point): boolean {
    return this.x == other.x && this.y == other.y;
  }
}

export let main = (): void => {
  // Test String Map
  let map = new Map<string, Box<i32>>();
  map.set('one', new Box(1));
  map.set('two', new Box(2));

  if (map.get('one', new Box(0)).value == 1) console.log('one: 1');
  else console.log('one: error');

  if (map.get('two', new Box(0)).value == 2) console.log('two: 2');
  else console.log('two: error');

  if (map.size == 2) console.log('size: 2');
  else console.log('size: error');

  if (map.has('one')) console.log('has one: true');
  else console.log('has one: false');

  if (map.has('three')) console.log('has three: true');
  else console.log('has three: false');

  map.delete('one');

  if (map.size == 1) console.log('size after delete: 1');
  else console.log('size after delete: error');

  if (map.has('one')) console.log('has one after delete: true');
  else console.log('has one after delete: false');

  // Test Object Map
  let pointMap = new Map<Point, string>();
  let p1 = new Point(1, 2);
  let p2 = new Point(3, 4);
  let p3 = new Point(1, 2); // Equal to p1

  pointMap.set(p1, 'Point 1');
  pointMap.set(p2, 'Point 2');

  // Strings are supported in interpolation
  console.log(`p1: ${pointMap.get(p1, 'null')}`);
  console.log(`p2: ${pointMap.get(p2, 'null')}`);
  console.log(`p3 (equal to p1): ${pointMap.get(p3, 'null')}`);
};
